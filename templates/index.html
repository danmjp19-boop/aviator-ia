<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>‚úàÔ∏è Aviator Pronosticador IA</title>
<style>
body{background:#000;color:cyan;font-family:Arial,sans-serif;text-align:center;margin:0;padding:20px;}
h1{color:#00ffff;margin:6px 0;}
.container{max-width:400px;margin:0 auto;background:#111;padding:20px;border-radius:15px;box-shadow:0 0 15px cyan;display:flex;flex-direction:column;align-items:center;}
#hora{font-size:1.2em;color:#0ff;margin-bottom:10px;}
#analisisInput{width:120px;padding:5px;border:1px solid cyan;background:#000;color:cyan;border-radius:8px;text-align:center;}
#analizarBtn{padding:6px 10px;background:cyan;color:#000;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
#display{background:#000;color:#0ff;font-size:2em;padding:10px;border:2px solid cyan;border-radius:10px;min-height:40px;margin-bottom:10px;width:100%;}
.teclado{width:100%;display:flex;flex-wrap:wrap;justify-content:space-between;}
.teclado button{width:30%;margin:5px;padding:10px;font-size:1.2em;border-radius:10px;background:#022;color:cyan;border:1px solid #0ff;cursor:pointer;}
.acciones{margin-top:10px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;width:100%;}
.acciones button{flex:1;padding:10px;border-radius:10px;background:cyan;color:black;font-weight:bold;cursor:pointer;}
.limpiar{background:#f00;color:white;margin-top:20px;width:100%;font-weight:bold;border:2px solid #faa;}
#graficoWrap{width:100%;height:260px;background:#000;border:2px solid cyan;border-radius:10px;padding:8px;margin-top:12px;overflow:hidden;}
#graficoWrap canvas{width:100%!important;height:100%!important;display:block;}
#mensaje_ia{margin-top:15px;font-size:1.2em;color:lime;min-height:1.5em;}
#historial{margin-top:15px;display:flex;overflow-x:auto;gap:6px;padding-bottom:10px;border-top:1px solid cyan;border-bottom:1px solid cyan;width:100%;}
#historial span{background:#033;padding:5px 10px;border-radius:5px;color:white;white-space:nowrap;font-weight:bold;}
.user-bar{margin-bottom:10px;text-align:center;font-size:0.95em;}
.user-bar span{color:#0ff;font-weight:bold;}
.user-bar a{color:#ff5555;text-decoration:none;font-weight:bold;margin-left:8px;}
.user-bar a:hover{text-decoration:underline;}
/* Bloque MT-2 */
#mt2{
  width:100%;
  margin-bottom:8px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:6px;
  background:#111;
  padding:4px;
  border:1px solid cyan;
  border-radius:8px;
  box-shadow:0 0 6px cyan;
  font-size:0.9em;
}
#mt2 .titulo{color:cyan;font-weight:bold;}
#mt2 input{
  width:80px;
  text-align:center;
  background:#000;
  border:1px solid cyan;
  color:cyan;
  border-radius:6px;
  padding:3px;
}
#mt2 button{
  background:cyan;
  color:#000;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
  padding:3px 6px;
}
#tiempoMT2{
  min-width:75px;
  color:lime;
  font-weight:bold;
  transition:all .3s;
}
</style>
</head>
<body>
<h1>‚úàÔ∏è Aviator Pronosticador IA</h1>

<div class="user-bar">
  <span>üìß {{ usuario }}</span> |
  <a href="/logout">Cerrar sesi√≥n</a>
</div>

<div class="container">

  <div id="hora">üïí --:--:--</div>

  <div>
    <input type="text" id="analisisInput" placeholder="1.84x 03:52:27">
    <button id="analizarBtn">Iniciar</button>
  </div>

  <div id="display"></div>

  <!-- Bloque MT-2 -->
  <div id="mt2">
    <span class="titulo">MT-2</span>
    <input type="text" id="semillaMT2" placeholder="04:33:58">
    <button id="btnMT2">‚ñ∂</button>
    <span id="tiempoMT2">--:--:--</span>
  </div>

  <div class="teclado">
    <button onclick="tecla('1')">1</button>
    <button onclick="tecla('2')">2</button>
    <button onclick="tecla('3')">3</button>
    <button onclick="tecla('4')">4</button>
    <button onclick="tecla('5')">5</button>
    <button onclick="tecla('6')">6</button>
    <button onclick="tecla('7')">7</button>
    <button onclick="tecla('8')">8</button>
    <button onclick="tecla('9')">9</button>
    <button onclick="tecla('.')">.</button>
    <button onclick="tecla('0')">0</button>
    <button onclick="tecla('Borrar')">Borrar</button>
  </div>

  <div class="acciones">
    <button onclick="guardar()">Ingresar</button>
    <button onclick="deshacer()">‚Ü©Ô∏è Deshacer</button>
  </div>

  <button class="limpiar" onclick="limpiarPantalla()">üßπ Limpiar Pantalla</button>

  <div id="mensaje_ia"></div>

  <div id="graficoWrap">
    <canvas id="grafico"></canvas>
  </div>
</div>

<h2>Historial</h2>
<div id="historial">
  {% for h in historial %}
    <span>{{'%.2f'|format(h)}}</span>
  {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* Reloj */
const horaDiv=document.getElementById("hora");
function actualizarHora(){horaDiv.textContent="üïí "+new Date().toLocaleTimeString('es-ES',{hour12:false});}
setInterval(actualizarHora,1000);actualizarHora();

/* Display y botones */
const display=document.getElementById("display");
const historialDiv=document.getElementById("historial");

function tecla(t){
  if(t==="Borrar"){display.innerText=display.innerText.slice(0,-1);}
  else{display.innerText+=t;}
}

/* Gr√°fico */
const ctx=document.getElementById('grafico').getContext('2d');
const chart=new Chart(ctx,{
  type:'line',
  data:{labels:[],datasets:[{label:'Tendencia',data:[],borderColor:'cyan',tension:0.1,pointRadius:4,pointBackgroundColor:'cyan'}]},
  options:{
    responsive:true,
    scales:{x:{ticks:{color:'cyan'}},y:{ticks:{color:'cyan'}}},
    plugins:{legend:{display:false}}
  }
});

function actualizarGrafico(){
  const datos=[...historialDiv.children].map(s=>parseFloat(s.textContent)).filter(v=>!isNaN(v));
  chart.data.labels=datos.map((_,i)=>i+1);
  chart.data.datasets[0].data=datos;
  chart.update();
}

/* Acciones */
function guardar(){
  const valor=parseFloat(display.innerText);
  if(isNaN(valor))return;
  const span=document.createElement("span");
  span.textContent=valor.toFixed(2);
  historialDiv.appendChild(span);
  display.textContent="";
  actualizarGrafico();
}

function deshacer(){
  if(historialDiv.lastChild)historialDiv.removeChild(historialDiv.lastChild);
  actualizarGrafico();
}

function limpiarPantalla(){
  if(confirm("¬øLimpiar todo?")){
    historialDiv.innerHTML="";
    display.textContent="";
    actualizarGrafico();
  }
}

/* ---------- BLOQUE MT-2 ---------- */
const intervalos=[
  {h:0,m:0,s:42},
  {h:0,m:1,s:33},
  {h:0,m:2,s:18},
  {h:0,m:2,s:49},
  {h:0,m:3,s:30}
];
let tiempos=[],indexActual=0,timer=null;
const span=document.getElementById('tiempoMT2');
const input2=document.getElementById('semillaMT2');
const btn2=document.getElementById('btnMT2');

function parseHora(str){const[h,m,s]=str.split(':').map(Number);const d=new Date();d.setHours(h,m,s,0);return d;}
function sumar(base,{h,m,s}){const n=new Date(base);n.setSeconds(n.getSeconds()+h*3600+m*60+s);return n;}
function fmt(d){return d.toTimeString().split(' ')[0];}

function actualizarMT2(titila){
  if(indexActual>=tiempos.length){span.textContent="‚úÖ";span.style.color='cyan';return;}
  span.textContent=fmt(tiempos[indexActual]);
  span.style.color=titila?(span.style.color==='red'?'lime':'red'):'lime';
}
function verificarMT2(){
  const ahora=new Date();
  if(indexActual>=tiempos.length){clearInterval(timer);return;}
  const objetivo=tiempos[indexActual];
  const diff=(objetivo-ahora)/1000;
  const titila=Math.abs(diff)<=10;
  actualizarMT2(titila);
  if(diff<=0)indexActual++;
}
function iniciarMT2(){
  const val=input2.value.trim();
  if(!val.match(/^\d{2}:\d{2}:\d{2}$/)){alert('Formato: HH:MM:SS');return;}
  const base=parseHora(val);tiempos=[base];
  for(let i=0;i<intervalos.length;i++)tiempos.push(sumar(tiempos[i],intervalos[i]));
  indexActual=1;clearInterval(timer);
  verificarMT2();timer=setInterval(verificarMT2,1000);
}
btn2.addEventListener('click',iniciarMT2);
</script>
</body>
</html>
