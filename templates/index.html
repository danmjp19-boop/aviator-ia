<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>‚úàÔ∏è Aviator Pronosticador IA</title>
<style>
body{background:#000;color:cyan;font-family:Arial,sans-serif;text-align:center;margin:0;padding:20px;}
h1{color:#00ffff;margin:6px 0;}
.container{max-width:400px;margin:0 auto;background:#111;padding:20px;border-radius:15px;box-shadow:0 0 15px cyan;display:flex;flex-direction:column;align-items:center;}
#hora-analisis{display:flex;justify-content:space-between;align-items:center;width:100%;margin-bottom:10px;}
#hora{font-size:1.2em;color:#0ff;letter-spacing:1px;}
#analisisInput{width:120px;padding:5px;border:1px solid cyan;background:#000;color:cyan;border-radius:8px;text-align:center;}
#analizarBtn{padding:6px 10px;background:cyan;color:#000;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
#display{background:#000;color:#0ff;font-size:2em;padding:10px;border:2px solid cyan;border-radius:10px;min-height:40px;margin-bottom:15px;width:100%;}
.teclado button{width:30%;margin:5px;padding:10px;font-size:1.2em;border-radius:10px;background:#022;color:cyan;border:1px solid #0ff;cursor:pointer;}
.acciones{margin-top:10px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;width:100%;}
.acciones button{flex:1;padding:10px;border-radius:10px;background:cyan;color:black;font-weight:bold;cursor:pointer;}
.limpiar{background:#f00;color:white;margin-top:20px;width:100%;font-weight:bold;border:2px solid #faa;}
#graficoWrap{width:100%;height:260px;background:#000;border:2px solid cyan;border-radius:10px;padding:8px;margin-top:12px;overflow:hidden;}
#graficoWrap canvas{width:100%!important;height:100%!important;display:block;touch-action:none;-ms-touch-action:none;}
#mensaje_ia{margin-top:15px;font-size:1.2em;color:lime;min-height:1.5em;}
#historial{margin-top:15px;display:flex;overflow-x:auto;gap:6px;padding-bottom:10px;border-top:1px solid cyan;border-bottom:1px solid cyan;width:100%;}
#historial span{background:#033;padding:5px 10px;border-radius:5px;color:white;white-space:nowrap;font-weight:bold;}
.user-bar{margin-bottom:10px;text-align:center;font-size:0.95em;}
.user-bar span{color:#0ff;font-weight:bold;}
.user-bar a{color:#ff5555;text-decoration:none;font-weight:bold;margin-left:8px;}
.user-bar a:hover{text-decoration:underline;}
/* Estilo M√©todo 2 */
#metodo2{width:100%;margin-bottom:15px;padding:10px;border:2px solid cyan;border-radius:10px;background:#111;box-shadow:0 0 10px cyan;}
#metodo2 input{width:130px;text-align:center;padding:5px;border:1px solid cyan;border-radius:8px;background:#000;color:cyan;}
#metodo2 button{margin-top:8px;padding:5px 12px;border:none;border-radius:10px;background:cyan;color:black;font-weight:bold;cursor:pointer;}
#tiempoActual{margin-top:8px;padding:6px;font-size:1.2em;border-radius:10px;background:#222;transition:background .3s;}
</style>
</head>
<body>
<h1>‚úàÔ∏è Aviator Pronosticador IA</h1>

<div class="user-bar">
  <span>üìß {{ usuario }}</span> |
  <a href="/logout">Cerrar sesi√≥n</a>
</div>

<div class="container">
  <div id="hora-analisis">
    <div id="hora"></div>
    <div>
      <input type="text" id="analisisInput" placeholder="1.84x 03:52:27">
      <button id="analizarBtn">Iniciar</button>
    </div>
  </div>

  <div id="display"></div>

  <!-- === M√âTODO 2 === -->
  <div id="metodo2">
    <h3>‚è±Ô∏è M√âTODO 2</h3>
    <input type="text" id="semilla" placeholder="04:33:58">
    <br>
    <button onclick="iniciarMetodo2()">Iniciar</button>
    <div id="tiempoActual">Esperando semilla...</div>
  </div>

  <div class="teclado">
    {% for n in [1,2,3,4,5,6,7,8,9,'.',0,'Borrar'] %}
      <button onclick="tecla('{{n}}')">{{n}}</button>
    {% endfor %}
  </div>

  <div class="acciones">
    <button onclick="guardar()">Ingresar</button>
    <button onclick="deshacer()">‚Ü©Ô∏è Deshacer</button>
  </div>

  <button class="limpiar" onclick="limpiarPantalla()">üßπ Limpiar Pantalla</button>

  <div id="mensaje_ia"></div>

  <div id="graficoWrap">
    <canvas id="grafico"></canvas>
  </div>
</div>

<h2>Historial</h2>
<div id="historial">
  {% for h in historial %}
    <span>{{'%.2f'|format(h)}}</span>
  {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  /* Tu c√≥digo original (sin cambios) ... */

  // === M√âTODO 2 ===
  const intervalos=[
    {h:0,m:0,s:42},
    {h:0,m:1,s:33},
    {h:0,m:2,s:18},
    {h:0,m:2,s:49},
    {h:0,m:3,s:30}
  ];
  let tiempos=[],indexActual=0,intervaloReloj=null;

  function parseHora(horaStr){const[h,m,s]=horaStr.split(':').map(Number);const d=new Date();d.setHours(h,m,s,0);return d;}
  function sumarTiempo(base,{h,m,s}){const n=new Date(base);n.setSeconds(n.getSeconds()+h*3600+m*60+s);return n;}
  function formatearHora(d){return d.toTimeString().split(' ')[0];}

  window.iniciarMetodo2=()=>{
    const sem=document.getElementById('semilla').value.trim();
    if(!sem.match(/^\d{2}:\d{2}:\d{2}$/)){alert('Formato inv√°lido HH:MM:SS');return;}
    const base=parseHora(sem);
    tiempos=[base];
    for(let i=0;i<intervalos.length;i++) tiempos.push(sumarTiempo(tiempos[i],intervalos[i]));
    indexActual=1;
    if(intervaloReloj) clearInterval(intervaloReloj);
    actualizarVista();
    intervaloReloj=setInterval(verificarTiempo,1000);
  };

  function actualizarVista(titilar=false){
    const div=document.getElementById('tiempoActual');
    if(indexActual>=tiempos.length){div.textContent="Secuencia finalizada ‚úÖ";div.style.background='#222';return;}
    div.textContent="Pr√≥ximo tiempo: "+formatearHora(tiempos[indexActual]);
    div.style.background=titilar?(div.style.background==='red'?'#222':'red'):'#222';
  }

  function verificarTiempo(){
    const ahora=new Date();
    if(indexActual>=tiempos.length){clearInterval(intervaloReloj);return;}
    const objetivo=tiempos[indexActual];
    const diff=(objetivo-ahora)/1000;
    if(Math.abs(diff)<=10){actualizarVista(true);}else{actualizarVista(false);}
    if(diff<=0){indexActual++;}
  }
});
</script>
</body>
</html>
