<!DOCTYPE html>    
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>‚úàÔ∏è Aviator Pronosticador IA</title>
<style>
/* tus estilos EXACTOS (no modifiqu√© visual) */
body{background:#000;color:cyan;font-family:Arial,sans-serif;text-align:center;margin:0;padding:20px;}
h1{color:#00ffff;margin:6px 0;}
.container{max-width:400px;margin:0 auto;background:#111;padding:20px;border-radius:15px;box-shadow:0 0 15px cyan;display:flex;flex-direction:column;align-items:center;}
#hora-analisis{display:flex;justify-content:space-between;align-items:center;width:100%;margin-bottom:10px;}
#hora{font-size:1.2em;color:#0ff;letter-spacing:1px; transition:color .25s, text-shadow .25s;}
#analisisInput{width:120px;padding:5px;border:1px solid cyan;background:#000;color:cyan;border-radius:8px;text-align:center;}
#analizarBtn{padding:6px 10px;background:cyan;color:#000;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
#display{background:#000;color:#0ff;font-size:2em;padding:10px;border:2px solid cyan;border-radius:10px;min-height:40px;margin-bottom:15px;width:100%;}
.teclado button{width:30%;margin:5px;padding:10px;font-size:1.2em;border-radius:10px;background:#022;color:cyan;border:1px solid #0ff;cursor:pointer;}
.acciones{margin-top:10px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;width:100%;}
.acciones button{flex:1;padding:10px;border-radius:10px;background:cyan;color:black;font-weight:bold;cursor:pointer;}
.limpiar{background:#f00;color:white;margin-top:20px;width:100%;font-weight:bold;border:2px solid #faa;}
#graficoWrap{width:100%;height:260px;background:#000;border:2px solid cyan;border-radius:10px;padding:8px;margin-top:12px;overflow:hidden;}
#graficoWrap canvas{width:100%!important;height:100%!important;display:block;touch-action:none;-ms-touch-action:none;}
#mensaje_ia{margin-top:15px;font-size:1.2em;color:lime;min-height:1.5em;}
#historial{margin-top:15px;display:flex;overflow-x:auto;gap:6px;padding-bottom:10px;border-top:1px solid cyan;border-bottom:1px solid cyan;width:100%;}
#historial span{background:#033;padding:5px 10px;border-radius:5px;color:white;white-space:nowrap;font-weight:bold;}
.user-bar{margin-bottom:10px;text-align:center;font-size:0.95em;}
.user-bar span{color:#0ff;font-weight:bold;}
.user-bar a{color:#ff5555;text-decoration:none;font-weight:bold;margin-left:8px;}
.user-bar a:hover{text-decoration:underline;}
.hora-rosa{ color: #ff66cc !important; text-shadow:0 0 10px #ff99dd, 0 0 20px #ff66cc !important; }
</style>
</head>
<body>
<h1>‚úàÔ∏è Aviator Pronosticador IA</h1>

<div class="user-bar">
  <span>üìß {{ usuario }}</span> |
  <a href="/logout">Cerrar sesi√≥n</a>
</div>

<div class="container">
  <div id="hora-analisis">
    <div id="hora"></div>
    <div>
      <input type="text" id="analisisInput" placeholder="1.84x 03:52:27">
      <button id="analizarBtn">Iniciar</button>
    </div>
  </div>

  <div id="display"></div>

  <!-- ----- MT-2 ----- -->
  <div id="mt2" style="width:100%;margin-bottom:8px;display:flex;justify-content:center;align-items:center;gap:6px;background:#111;padding:4px;border:1px solid cyan;border-radius:8px;box-shadow:0 0 6px cyan;font-size:0.9em;">
    <span style="color:cyan;font-weight:bold;">MT-2</span>
    <input id="mt2_semilla" type="text" placeholder="04:33:58" style="width:80px;text-align:center;background:#000;border:1px solid cyan;color:cyan;border-radius:6px;padding:3px;">
    <button id="mt2_btn" style="background:cyan;color:#000;border:none;border-radius:6px;font-weight:bold;cursor:pointer;padding:3px 6px;">‚ñ∂</button>
    <span id="mt2_tiempo" style="min-width:75px;color:lime;font-weight:bold;transition:all .3s;">--:--:--</span>
  </div>
  <!-- ----- fin MT-2 ----- -->

  <div class="teclado">
    {% for n in [1,2,3,4,5,6,7,8,9,'.',0,'Borrar'] %}
      <button onclick="tecla('{{n}}')">{{n}}</button>
    {% endfor %}
  </div>

  <div class="acciones">
    <button onclick="guardar()">Ingresar</button>
    <button onclick="deshacer()">‚Ü©Ô∏è Deshacer</button>
  </div>

  <button class="limpiar" onclick="limpiarPantalla()">üßπ Limpiar Pantalla</button>

  <div id="mensaje_ia"></div>

  <div id="graficoWrap">
    <canvas id="grafico"></canvas>
  </div>
</div>

<h2>Historial</h2>
<div id="historial">
  {% for h in historial %}
    <span>{{'%.2f'|format(h)}}</span>
  {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const horaDiv=document.getElementById("hora");

  const horasBase=[
    "14:18:47","14:25:27","14:29:58","14:31:02","14:32:32","14:33:49","14:35:05","14:38:59","14:41:36","14:42:48",
    "14:46:51","14:50:24","14:54:58","14:56:09","14:57:41","14:58:54","14:59:39","15:01:27","15:16:32","15:17:40",
    "15:21:16","15:24:56","15:26:35","15:28:29","15:32:34","15:36:16","15:37:33","15:42:12","15:44:51","15:55:34",
    "16:07:01","16:17:10","16:22:45","16:32:40","16:35:27","16:38:44","16:50:01","16:52:20","16:54:41","17:03:23",
    "17:04:36","17:09:38","17:10:49","17:13:45","17:14:33","17:17:55","17:19:25","17:20:58","17:26:10","17:32:18",
    "17:41:50","17:42:47","17:51:58","17:54:51","17:55:32"
  ];

  const mmssSet = new Set(horasBase.map(h => h.slice(3)));

  let highlightTimeout = null;
  let isHighlighted = false;

  function actualizarHora(){
    const ahora = new Date();
    const horaStr = ahora.toLocaleTimeString('es-ES',{hour12:false});
    horaDiv.innerText = "üïí " + horaStr;

    const actualMMSS = horaStr.slice(3);

    // ü©∑ ajuste 10s antes
    for(const h of horasBase){
      const [H,M,S] = h.split(':').map(Number);
      const target = new Date();
      target.setHours(H,M,S,0);
      const diff = (target - ahora)/1000; // diferencia en segundos

      if(diff <= 10 && diff >= 0 && !isHighlighted){ // 10 segundos antes o justo en el momento
        isHighlighted = true;
        horaDiv.classList.add('hora-rosa');
        clearTimeout(highlightTimeout);
        highlightTimeout = setTimeout(()=>{
          horaDiv.classList.remove('hora-rosa');
          isHighlighted = false;
        },10000);
      }
    }
  }

  setInterval(actualizarHora,1000);
  actualizarHora();
});
</script>

<!-- ----- Script MT-2 (sin cambios) ----- -->
<script>
(function(){
  function initMT2(){
    const btn=document.getElementById('mt2_btn');
    const input=document.getElementById('mt2_semilla');
    const span=document.getElementById('mt2_tiempo');
    if(!btn||!input||!span)return;
    const intervalos=[
      {h:0,m:0,s:42},
      {h:0,m:1,s:33},
      {h:0,m:2,s:18},
      {h:0,m:2,s:49},
      {h:0,m:3,s:30}
    ];
    let tiempos=[],idx=0,tHandle=null;
    function parseHora(str){
      const p=str.split(':').map(Number);
      if(p.length!==3||p.some(isNaN))return null;
      const d=new Date();d.setHours(p[0],p[1],p[2],0);return d;
    }
    function sumar(base,itv){
      const n=new Date(base.getTime());
      n.setSeconds(n.getSeconds()+(itv.h*3600+itv.m*60+itv.s));
      return n;
    }
    function fmt(d){return d?d.toTimeString().split(' ')[0]:'--:--:--';}
    function actualizar(titila){
      if(idx>=tiempos.length){
        span.textContent='‚úÖ';span.style.color='cyan';span.style.background='';span.style.boxShadow='';return;
      }
      span.textContent=fmt(tiempos[idx]);
      if(titila){span.style.background='red';span.style.color='#fff';span.style.boxShadow='0 0 8px red';}
      else{span.style.background='';span.style.color='lime';span.style.boxShadow='';}
    }
    function verificar(){
      const ahora=new Date();
      if(idx>=tiempos.length){clearInterval(tHandle);tHandle=null;return;}
      const objetivo=tiempos[idx];
      const diff=(objetivo-ahora)/1000;
      const alertWindow=Math.abs(diff)<=10;
      actualizar(alertWindow);
      if(diff<=0){idx++;actualizar(false);}
    }
    function iniciar(){
      const raw=input.value.trim();
      const base=parseHora(raw);
      if(!base){alert('Formato inv√°lido: HH:MM:SS');return;}
      tiempos=[base];
      for(let i=0;i<intervalos.length;i++){tiempos.push(sumar(tiempos[i],intervalos[i]));}
      idx=1;
      if(tHandle){clearInterval(tHandle);tHandle=null;}
      verificar();tHandle=setInterval(verificar,1000);
    }
    btn.addEventListener('click',iniciar);
    input.addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();iniciar();}});
  }
  if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initMT2);}else{initMT2();}
})();
</script>

</body>
</html>
