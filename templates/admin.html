<!DOCTYPE html> 
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin - Aviator Pronosticador IA</title>
<style>
    body { background:#000; color:#0ff; font-family: Arial, sans-serif; padding:20px; }
    .wrap { max-width:900px; margin:0 auto; }
    .panel { background:#111; padding:16px; border-radius:10px; box-shadow:0 0 12px cyan; }
    input, select { padding:8px; margin:6px 0; border-radius:6px; border:1px solid #0ff; background:#000; color:#0ff; width:100%; }
    button { padding:8px 12px; background:#0ff; color:#000; border:none; border-radius:6px; cursor:pointer; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { padding:8px; text-align:left; border-bottom:1px solid #222; }
    .danger { background:#f44;color:#fff;border:0;padding:6px 10px;border-radius:6px;cursor:pointer; }
    .small { font-size:0.9em; color:#9ff; }
    .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    a.logout { color:#0ff; text-decoration:none; border:1px solid #0ff; padding:6px 10px; border-radius:6px; }

    /* üîµ Indicador de estado */
    .estado {
        display:inline-block;
        width:10px;
        height:10px;
        border-radius:50%;
        margin-right:6px;
    }
    .activo { background:limegreen; box-shadow:0 0 6px limegreen; }
    .inactivo { background:red; box-shadow:0 0 6px red; }

    /* üîµ Nuevo estilo para bot√≥n ‚ÄúCerrar sesi√≥n‚Äù */
    .logout-btn {
        background:#09f;
        color:#fff;
        border:none;
        padding:6px 10px;
        border-radius:6px;
        cursor:pointer;
    }
</style>
</head>
<body>
<div class="wrap">
    <div class="topbar">
        <h2>üõ†Ô∏è Panel Admin</h2>
        <div>
            <span class="small">Admin: {{ admin }}</span>
            &nbsp; <a class="logout" href="{{ url_for('logout') }}">Cerrar sesi√≥n</a>
        </div>
    </div>

    <div class="panel">
        <h3>Crear usuario</h3>
        <form id="formCrear" method="POST" action="{{ url_for('admin_panel') }}">
            <label>Correo</label>
            <input name="email" type="email" placeholder="usuario@ejemplo.com" required />
            <label>Contrase√±a</label>
            <input name="password" type="text" placeholder="contrase√±a" required />
            <label>D√≠as de validez (1-30)</label>
            <input name="dias" type="number" min="1" max="3650" value="1" required />
            <button type="submit">Crear usuario</button>
        </form>
    </div>

    <div class="panel" style="margin-top:12px;">
        <h3>Usuarios existentes</h3>
        <table>
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Creado</th>
                    <th>Expira</th>
                    <th>D√≠as restantes</th>
                    <th>Admin</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="users_table">
            {% for u in users %}
                <tr>
                    <td>
                        <span class="estado {% if u.activo %}activo{% else %}inactivo{% endif %}"></span>
                        {{ u.email }}
                    </td>
                    <td>{{ u.created }}</td>
                    <td>{{ u.expires }}</td>
                    <td>{{ u.dias_restantes }} d√≠as</td>
                    <td>{{ 'S√≠' if u.is_admin else 'No' }}</td>
                    <td>
                        {% if not u.is_admin %}
                        <button class="danger" onclick="eliminarUsuario({{ u.id }}, '{{ u.email }}')">Eliminar</button>
                        <button onclick="extenderUsuario({{ u.id }}, '{{ u.email }}')">Extender</button>
                        {% if u.activo %}
                        <button class="logout-btn" onclick="cerrarSesionUsuario({{ u.id }}, '{{ u.email }}')">Cerrar sesi√≥n</button>
                        {% endif %}
                        {% else %}
                        <span class="small">Cuenta admin</span>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div style="margin-top:12px;">
        <a href="/panel" style="color:#0ff">Ir a la app</a>
    </div>
</div>

<script>
function eliminarUsuario(id, email){
    if(!confirm("¬øEliminar usuario " + email + "?")) return;
    window.location.href = "/eliminar_usuario/" + id;
}

function extenderUsuario(id, email){
    const dias = prompt("¬øCu√°ntos d√≠as deseas extender para " + email + "?", "7");
    if(!dias) return;
    const form = document.createElement("form");
    form.method = "POST";
    form.action = "/extender_usuario/" + id;
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = "dias";
    input.value = dias;
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
}

/* üîµ Nueva funci√≥n para cerrar sesi√≥n */
function cerrarSesionUsuario(id, email){
    if(!confirm("¬øCerrar sesi√≥n de " + email + "?")) return;
    window.location.href = "/forzar_logout/" + id;
}
</script>
</body>
</html>
